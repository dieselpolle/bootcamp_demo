<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Address data</title>
    <link rel="stylesheet" href="css/styles.css">
    <script type="text/javascript" src="js/tools.js"></script>
</head>

<body>
    <div class="container">
    <script>
        var jsonIpDataResponse;
        let urlParams = new URLSearchParams(window.location.search);

        var xhttp = new XMLHttpRequest();
        xhttp.open("GET", urlIpAdd+"/"+urlParams.get('ipAddressIs'));
        xhttp.setRequestHeader("content-type", "application/json");
        xhttp.setRequestHeader('Authorization', "Basic " + window.btoa(window.sessionStorage.getItem("apiUsername") + ":" + window.sessionStorage.getItem("apiPassword")));
        xhttp.send();
        //check if the api is available
        xhttp.onload = function () {
            if (xhttp.status != 200) { // analyze HTTP status of the response
                document.write("<p>storeIpData, httpstatus not 200: " + xhttp.responseText+"</p>");
            }
        };
        //check the state of the request processing, on state 4 the request is completely processed
        //returns the response
        xhttp.onreadystatechange = function () {
            if (xhttp.readyState == 4) {
                var data=xhttp.responseText;
                jsonIpDataResponse = JSON.parse(data);
                document.write("<head><link rel='stylesheet' href='css/styles.css'></head>");
                document.write("<body><table class='styled-table'>");
                document.write("<tr><th>IP:</td><td>"+jsonIpDataResponse[0].query+"</td></tr>");
                document.write("<tr><th>Country:</td><td>"+jsonIpDataResponse[0].country+"</td></tr>");
                document.write("<tr><th>Country code:</td><td>"+jsonIpDataResponse[0].countrycode+"</td></tr>");
                document.write("<tr><th>Region:</td><td>"+jsonIpDataResponse[0].region+"</td></tr>");
                document.write("<tr><th>Region name:</td><td>"+jsonIpDataResponse[0].regionname+"</td></tr>");
                document.write("<tr><th>City:</td><td>"+jsonIpDataResponse[0].city+"</td></tr>");
                document.write("<tr><th>Zip code:</td><td>"+jsonIpDataResponse[0].zip+"</td></tr>");
                document.write("<tr><th>LAT:</td><td>"+jsonIpDataResponse[0].lat+"</td></tr>");
                document.write("<tr><th>LON:</td><td>"+jsonIpDataResponse[0].lon+"</td></tr>");
                document.write("<tr><th>Timezone:</td><td>"+jsonIpDataResponse[0].timezone+"</td></tr>");
                document.write("<tr><th>ISP:</td><td>"+jsonIpDataResponse[0].isp+"</td></tr>");
                document.write("<tr><th>Organization:</td><td>"+jsonIpDataResponse[0].org+"</td></tr>");
                document.write("<tr><th>Organization:</td><td>"+jsonIpDataResponse[0].org2+"</td></tr>");
                document.write("</table></body>");

            }
        };
        //on error, return error
        xhttp.onerror = function () { //on other error, show alert
            document.write("<p>storeIpData, error: " + xhttp.responseText+"</p>");
        };
        
    </script>
    </div>
</body>

</html>